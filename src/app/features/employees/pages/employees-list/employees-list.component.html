<p class="sr-only" aria-live="polite">{{ resultsText() }}</p>

<header class="page-header">
  <div class="title">
    <h1 class="h1">Employees</h1>
    <p class="sub">Search, filter, and manage employees</p>
  </div>

  <a
    class="btn btn-primary"
    routerLink="/employees/new"
    aria-label="Add employee"
  >
    <span class="icon" aria-hidden="true">
      <!-- plus -->
      <svg viewBox="0 0 24 24">
        <path
          d="M12 5v14M5 12h14"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
        />
      </svg>
    </span>
    Add employee
  </a>
</header>

<section class="toolbar" aria-label="Employees filters">
  <div class="toolbar_row">
    <div class="search">
      <span class="icon" aria-hidden="true">
        <!-- search -->
        <svg viewBox="0 0 24 24">
          <path
            d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
          />
        </svg>
      </span>

      <input
        class="input input--search"
        type="search"
        [value]="q()"
        (input)="q.set($any($event.target).value || ''); page.set(1)"
        placeholder="Search name, email, titleâ€¦"
        aria-label="Search employees"
      />
    </div>

    <div class="filters">
      <label class="field">
        <span class="label">Status</span>
        <select
          class="select"
          [value]="status()"
          (change)="status.set($any($event.target).value); page.set(1)"
        >
          <option value="">All</option>
          <option value="active">Active</option>
          <option value="on_leave">On leave</option>
          <option value="inactive">Inactive</option>
        </select>
      </label>

      <label class="field">
        <span class="label">Department</span>
        <select
          class="select"
          [value]="departmentId() ?? ''"
          (change)="onDepartmentChange($event)"
        >
          <option value="">All</option>
          <option
            *ngFor="let d of departments(); trackBy: trackByDepartmentId"
            [value]="d.id"
          >
            {{ d.name }}
          </option>
        </select>
      </label>

      <button class="btn btn-ghost" type="button" (click)="clearFilters()">
        <span class="icon" aria-hidden="true">
          <!-- broom/clear -->
          <svg viewBox="0 0 24 24">
            <path
              d="M3 21h6M7 21l10-10M14 4l6 6M13 5l6 6"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
          </svg>
        </span>
        Clear
      </button>
    </div>
  </div>
</section>

<app-card title="Results" class="card-full">
  @if (loading()) {
    <div class="skeleton">
      <div class="sk sk-line"></div>
      <div class="sk sk-line"></div>
      <div class="sk sk-line"></div>
    </div>
  } @else if (error()) {
    <div class="error">
      <p role="alert">{{ error() }}</p>
      <button class="btn btn-primary" type="button" (click)="reload()">
        Retry
      </button>
    </div>
  } @else {
    @if (items().length === 0) {
      <div class="empty">
        <div class="emptyicon" aria-hidden="true">ðŸ‘¤</div>
        <h3>No employees found</h3>
        <p>Try clearing filters or adjusting your search.</p>
        <button class="btn btn-ghost" type="button" (click)="clearFilters()">
          Clear filters
        </button>
      </div>
    } @else {
      <div class="table-wrap" role="region" aria-label="Employees table">
        <table class="table">
          <tbody>
            <tr *ngFor="let e of items(); trackBy: trackByEmployeeId">
              <td>
                <div class="name">{{ e.firstName }} {{ e.lastName }}</div>
                <div class="meta">{{ e.email }}</div>
              </td>

              <td>{{ e.title }}</td>

              <td>{{ departmentName(e.departmentId) }}</td>

              <td>
                <span class="chip" [attr.data-status]="e.status">{{
                  e.status
                }}</span>
              </td>

              <td class="num">
                {{ e.salary | currency: "EUR" : "symbol" : "1.0-0" }}
              </td>
              <td>{{ e.hireDate | date: "dd/MM/yyyy" }}</td>

              <td class="actions-col">
                <a
                  class="icon-btn icon-btn--edit"
                  [routerLink]="['/employees', e.id, 'edit']"
                  aria-label="Edit employee"
                >
                  <svg viewBox="0 0 24 24">
                    <path
                      d="M12 20h9"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                    />
                    <path
                      d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5Z"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </a>

                <button
                  class="icon-btn icon-btn--danger"
                  type="button"
                  (click)="deleteEmployee(e)"
                  aria-label="Delete employee"
                >
                  <svg viewBox="0 0 24 24">
                    <path
                      d="M3 6h18"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                    />
                    <path
                      d="M8 6V4h8v2"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                    />
                    <path
                      d="M6 6l1 16h10l1-16"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                    />
                    <path
                      d="M10 11v6M14 11v6"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                    />
                  </svg>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="pager">
        <button
          class="btn btn-sm"
          (click)="setPage(page() - 1)"
          [disabled]="page() <= 1"
        >
          Prev
        </button>
        <span class="pager_text">Page {{ page() }} / {{ totalPages() }}</span>
        <button
          class="btn btn-sm"
          (click)="setPage(page() + 1)"
          [disabled]="page() >= totalPages()"
        >
          Next
        </button>

        <span class="spacer"></span>

        <label class="pager_label">
          Page size
          <select
            class="select select-sm"
            [value]="pageSize()"
            (change)="onPageSizeChange($event)"
          >
            <option [value]="10">10</option>
            <option [value]="20">20</option>
            <option [value]="50">50</option>
          </select>
        </label>
      </div>
    }
  }
</app-card>
